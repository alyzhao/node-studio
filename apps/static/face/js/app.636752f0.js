(function(e){function t(t){for(var a,s,o=t[0],l=t[1],u=t[2],c=0,f=[];c<o.length;c++)s=o[c],r[s]&&f.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(f.length)f.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},i=[];function s(e){return o.p+"js/"+({about:"about"}[e]||e)+"."+{about:"ad763791"}[e]+".js"}function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise(function(t,a){n=r[e]=[t,a]});t.push(n[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=s(e),i=function(t){l.onerror=l.onload=null,clearTimeout(u);var n=r[e];if(0!==n){if(n){var a=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src,s=new Error("Loading chunk "+e+" failed.\n("+a+": "+i+")");s.type=a,s.request=i,n[1](s)}r[e]=void 0}};var u=setTimeout(function(){i({type:"timeout",target:l})},12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(t)},o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/face/",o.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0694":function(e,t,n){},"0c92":function(e,t,n){"use strict";(function(e,t){n("55dd"),n("4917"),n("3846");var a,r=n("f499"),i=n.n(r),s=(n("a481"),n("5d58")),o=n.n(s),l=n("67bb"),u=n.n(l),c=(n("6b54"),n("34ef"),n("ac6a"),n("a4bb")),d=n.n(c),f=n("061b"),h=n.n(f),p=n("4d16"),v=n.n(p),m=n("4aa6"),y=n.n(m),g=n("85f2"),b=n.n(g),_=n("7618");(function(a){if("object"===("undefined"===typeof exports?"undefined":Object(_["a"])(exports))&&"undefined"!==typeof e)e.exports=a();else if("function"===typeof define&&n("3c35"))define([],a);else{var r;r="undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:this,r.Wfs=a()}})(function(){return function(){function e(t,n,r){function i(o,l){if(!n[o]){if(!t[o]){var u="function"==typeof a&&a;if(!l&&u)return a(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n||e)},d,d.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof a&&a,o=0;o<r.length;o++)i(r[o]);return i}return e}()({1:[function(e,t,n){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"===typeof e}function i(e){return"number"===typeof e}function s(e){return"object"===Object(_["a"])(e)&&null!==e}function o(e){return void 0===e}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},a.prototype.emit=function(e){var t,n,a,i,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),u=n.slice(),a=u.length,l=0;l<a;l++)u[l].apply(this,i);return!0},a.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=o(this._maxListeners)?a.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function a(){this.removeListener(e,a),n||(n=!0,t.apply(this,arguments))}return a.listener=t,this.on(e,a),this},a.prototype.removeListener=function(e,t){var n,a,i,o;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(o=i;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=o;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},a.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)while(n.length)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},a.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},a.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},a.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../events"),i=l(r),s=e("../event-handler"),o=l(s);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==Object(_["a"])(t)&&"function"!==typeof t?e:t}function f(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+Object(_["a"])(t));e.prototype=y()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(v.a?v()(e,t):e.__proto__=t)}var p=function(e){function t(e){u(this,t);var n=c(this,(t.__proto__||h()(t)).call(this,e,i.default.MEDIA_ATTACHING,i.default.BUFFER_APPENDING,i.default.BUFFER_RESET));return n.mediaSource=null,n.media=null,n.pendingTracks={},n.sourceBuffer={},n.segments=[],n.appended=0,n._msDuration=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(n.browserType=1),n.mediaType="H264Raw",n.websocketName=void 0,n.channelName=void 0,n}return f(t,e),a(t,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(this.mediaType=e.mediaType,this.websocketName=e.websocketName,this.channelName=e.channelName,t){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onMediaSourceClose",value:function(){console.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){console.log("media source ended")}},{key:"onSBUpdateEnd",value:function(e){1===this.browserType&&(this.mediaSource.endOfStream(),this.media.play()),this.appending=!1,this.doAppending(),this.updateMediaElementDuration()}},{key:"updateMediaElementDuration",value:function(){}},{key:"onMediaSourceOpen",value:function(){var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),"FMp4"===this.mediaType&&this.checkPendingTracks(),this.wfs.trigger(i.default.MEDIA_ATTACHED,{media:this.media,channelName:this.channelName,mediaType:this.mediaType,websocketName:this.websocketName})}},{key:"checkPendingTracks",value:function(){this.createSourceBuffers({tracks:"video",mimeType:""}),this.pendingTracks={}}},{key:"onBufferReset",value:function(e){"H264Raw"===this.mediaType&&this.createSourceBuffers({tracks:"video",mimeType:e.mimeType})}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,n=this.mediaSource,a=void 0;a=""===e.mimeType?"video/mp4;codecs=avc1.420028":"video/mp4;codecs="+e.mimeType;try{var r=t["video"]=n.addSourceBuffer(a);r.addEventListener("updateend",this.onsbue),track.buffer=r}catch(s){}this.wfs.trigger(i.default.BUFFER_CREATED,{tracks:e}),this.media.play()}},{key:"doAppending",value:function(){var e=this.wfs,t=this.sourceBuffer,n=this.segments;if(d()(t).length){if(this.media.error)return this.segments=[],void console.log("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var a=n.shift();try{t[a.type]&&(this.parent=a.parent,t[a.type].appendBuffer(a.data),this.appendError=0,this.appended++,this.appending=!0)}catch(i){n.unshift(a);var r={type:ErrorTypes.MEDIA_ERROR};if(22===i.code)return this.segments=[],void(r.details=ErrorDetails.BUFFER_FULL_ERROR);if(this.appendError?this.appendError++:this.appendError=1,r.details=ErrorDetails.BUFFER_APPEND_ERROR,r.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return n=[],void(r.fatal=!0);r.fatal=!1}}}}}]),t}(o.default);n.default=p},{"../event-handler":7,"../events":8}],3:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../events"),i=l(r),s=e("../event-handler"),o=l(s);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==Object(_["a"])(t)&&"function"!==typeof t?e:t}function d(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+Object(_["a"])(t));e.prototype=y()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(v.a?v()(e,t):e.__proto__=t)}var f=function(e){function t(e){u(this,t);var n=c(this,(t.__proto__||h()(t)).call(this,e,i.default.MEDIA_ATTACHED,i.default.BUFFER_CREATED,i.default.FILE_PARSING_DATA,i.default.FILE_HEAD_LOADED,i.default.FILE_DATA_LOADED,i.default.WEBSOCKET_ATTACHED,i.default.FRAG_PARSING_DATA,i.default.FRAG_PARSING_INIT_SEGMENT));return n.fileStart=0,n.fileEnd=0,n.pendingAppending=0,n.mediaType=void 0,n.channelName,n}return d(t,e),a(t,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){if(void 0!=e.websocketName){var t=new WebSocket("ws://"+e.websocketName);this.wfs.attachWebsocket(t,e.channelName)}else console.log("websocketName ERROE!!!")}},{key:"onBufferCreated",value:function(e){this.mediaType=e.mediaType}},{key:"onFileHeadLoaded",value:function(e){}},{key:"onFileDataLoaded",value:function(e){}},{key:"onFileParsingData",value:function(e){}},{key:"onWebsocketAttached",value:function(e){this.wfs.trigger(i.default.BUFFER_APPENDING,{type:"video",data:e.payload,parent:"main"})}},{key:"onFragParsingInitSegment",value:function(e){var t,n,a=e.tracks;for(t in n=a.video,n&&(n.id=e.id),a){n=a[t];var r=n.initSegment;r&&(this.pendingAppending++,this.wfs.trigger(i.default.BUFFER_APPENDING,{type:t,data:r,parent:"main"}))}}},{key:"onFragParsingData",value:function(e){var t=this;e.type,[e.data1,e.data2].forEach(function(n){n&&(t.pendingAppending++,t.wfs.trigger(i.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main"}))})}}]),t}(o.default);n.default=f},{"../event-handler":7,"../events":8}],4:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../utils/logger");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return a(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),n=Math.min(4,this.bytesAvailable);if(0===n)throw new Error("no bytes available");t.set(this.data.subarray(e,e+n)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&r.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,a=8,r=8;for(t=0;t<e;t++)0!==r&&(n=this.readEG(),r=(a+n+256)%256),a=0===r?a:r}},{key:"readSPS",value:function(){var e,t,n,a,r,i,s,o=0,l=0,u=0,c=0,d=1;if(this.readUByte(),e=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var f=this.readUEG();if(3===f&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(i=3!==f?8:12,s=0;s<i;s++)this.readBoolean()&&(s<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var h=this.readUEG();if(0===h)this.readUEG();else if(1===h)for(this.skipBits(1),this.skipEG(),this.skipEG(),t=this.readUEG(),s=0;s<t;s++)this.skipEG();if(this.skipUEG(),this.skipBits(1),n=this.readUEG(),a=this.readUEG(),r=this.readBits(1),0===r&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),l=this.readUEG(),u=this.readUEG(),c=this.readUEG()),this.readBoolean()&&this.readBoolean()){var p=void 0,v=this.readUByte();switch(v){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}p&&(d=p[0]/p[1])}return{width:Math.ceil((16*(n+1)-2*o-2*l)*d),height:(2-r)*(a+1)*16-(r?2:4)*(u+c)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=s},{"../utils/logger":15}],5:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../events"),i=f(r),s=e("./exp-golomb"),o=f(s),l=e("../event-handler"),u=f(l),c=e("../remux/mp4-remuxer"),d=f(c);function f(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==Object(_["a"])(t)&&"function"!==typeof t?e:t}function g(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+Object(_["a"])(t));e.prototype=y()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(v.a?v()(e,t):e.__proto__=t)}var E=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;p(this,t);var a=m(this,(t.__proto__||h()(t)).call(this,e,i.default.H264_DATA_PARSED));return a.config=a.wfs.config||n,a.wfs=e,a.id="main",a.remuxer=new d.default(a.wfs,a.id,a.config),a.contiguous=!0,a.timeOffset=1,a.sn=0,a.TIMESCALE=9e4,a.timestamp=0,a.scaleFactor=a.TIMESCALE/1e3,a.H264_TIMEBASE=3e3,a._avcTrack={container:"video/mp2t",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0},a.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(a.browserType=1),a}return g(t,e),a(t,[{key:"destroy",value:function(){u.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function(){return this.timestamp+=this.H264_TIMEBASE,this.timestamp}},{key:"onH264DataParsed",value:function(e){this._parseAVCTrack(e.data),(1===this.browserType||this._avcTrack.samples.length>=20)&&(this.remuxer.pushVideo(0,this.sn,this._avcTrack,this.timeOffset,this.contiguous),this.sn+=1)}},{key:"_parseAVCTrack",value:function(e){var t,n,a,r,s=this,l=this._avcTrack,u=l.samples,c=this._parseAVCNALu(e),d=[],f=!1,h=!1,p=0,v="",m=function(){if(d.length){if(!this.config.forceKeyFrameOnDiscontinuity||!0===h||l.sps&&(u.length||this.contiguous)){var e=this.getTimestampM();n={units:{units:d,length:p},pts:e,dts:e,key:h},u.push(n),l.len+=p,l.nbNalu+=d.length}else l.dropped++;d=[],p=0}}.bind(this);c.forEach(function(e){switch(e.type){case 1:a=!0,f&&(v+="NDR ");break;case 5:a=!0,f&&(v+="IDR "),h=!0;break;case 6:e.data=s.discardEPB(e.data),t=new o.default(e.data),t.readUByte();break;case 7:if(a=!1,f&&(v+="SPS "),!l.sps){t=new o.default(e.data);var n=t.readSPS();l.width=n.width,l.height=n.height,l.sps=[e.data],l.duration=0;var u=e.data.subarray(1,4),c="avc1.";for(r=0;r<3;r++){var y=u[r].toString(16);y.length<2&&(y="0"+y),c+=y}l.codec=c,s.wfs.trigger(i.default.BUFFER_RESET,{mimeType:l.codec}),a=!0}break;case 8:a=!1,f&&(v+="PPS "),l.pps||(l.pps=[e.data],a=!0);break;case 9:a=!1,f&&(v+="AUD "),m();break;default:a=!1,v+="unknown NAL "+e.type+" ";break}a&&(d.push(e),p+=e.data.byteLength)}),(f||v.length)&&logger.log(v),m()}},{key:"_parseAVCNALu",value:function(e){var t,n,a,r,i,s=0,o=e.byteLength,l=0,u=[];while(s<o)switch(t=e[s++],l){case 0:0===t&&(l=1);break;case 1:l=0===t?2:0;break;case 2:case 3:0===t?l=3:1===t&&s<o?(a=31&e[s],r&&(n={data:e.subarray(r,s-l-1),type:i},u.push(n)),r=s,i=a,l=0):l=0;break;default:break}return r&&(n={data:e.subarray(r,o),type:i,state:l},u.push(n)),u}},{key:"discardEPB",value:function(e){var t,n,a=e.byteLength,r=[],i=1;while(i<a-2)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;t=a-r.length,n=new Uint8Array(t);var s=0;for(i=0;i<t;s++,i++)s===r[0]&&(s++,r.shift()),n[i]=e[s];return n}}]),t}(u.default);n.default=E},{"../event-handler":7,"../events":8,"../remux/mp4-remuxer":13,"./exp-golomb":4}],6:[function(e,t,n){b()(n,"__esModule",{value:!0});n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],7:[function(e,t,n){b()(n,"__esModule",{value:!0});var a="function"===typeof u.a&&"symbol"===Object(_["a"])(o.a)?function(e){return Object(_["a"])(e)}:function(e){return e&&"function"===typeof u.a&&e.constructor===u.a&&e!==u.a.prototype?"symbol":Object(_["a"])(e)},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=e("./events");s(i);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=function(){function e(t){l(this,e),this.wfs=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];this.handledEvents=a,this.useGenericHandler=!0,this.registerListeners()}return r(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===a(this.handledEvents)&&this.handledEvents.length&&"function"===typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("wfs","");return this[n],this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(a){console.log("internal error happened while processing "+e+":"+a.message)}}}]),e}();n.default=c},{"./events":8}],8:[function(e,t,n){t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",H264_DATA_PARSING:"wfsH264DataParsing",H264_DATA_PARSED:"wfsH264DataParsed",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",WEBSOCKET_MESSAGE_SENDING:"wfsWebsocketMessageSending",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData"}},{}],9:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(){r(this,e)}return a(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();n.default=i},{}],10:[function(e,t,n){t.exports=e("./wfs.js").default},{"./wfs.js":18}],11:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../events"),s=d(r),o=e("../event-handler"),l=d(o),u=e("../utils/h264-nal-slicesreader.js"),c=d(u);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==Object(_["a"])(t)&&"function"!==typeof t?e:t}function m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+Object(_["a"])(t));e.prototype=y()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(v.a?v()(e,t):e.__proto__=t)}var g=function(e){function t(e){f(this,t);var n=p(this,(t.__proto__||h()(t)).call(this,e,s.default.WEBSOCKET_ATTACHING,s.default.WEBSOCKET_DATA_UPLOADING,s.default.WEBSOCKET_MESSAGE_SENDING));return n.buf=null,n.slicesReader=new c.default(e),n.mediaType=void 0,n.channelName=void 0,n}return m(t,e),a(t,[{key:"destroy",value:function(){this.client&&this.client.close(),this.slicesReader.destroy(),l.default.prototype.destroy.call(this)}},{key:"onWebsocketAttaching",value:function(e){this.mediaType=e.mediaType,this.channelName=e.channelName,e.websocket instanceof WebSocket&&(this.client=e.websocket,this.client.onopen=this.initSocketClient.bind(this),this.client.onclose=function(e){console.log("Websocket Disconnected!")})}},{key:"initSocketClient",value:function(e){console.log(this.client),this.client.send("start"),this.client.binaryType="arraybuffer",this.client.onmessage=this.receiveSocketMessage.bind(this),this.wfs.trigger(s.default.WEBSOCKET_MESSAGE_SENDING,{commandType:"open",channelName:this.channelName,commandValue:"NA"}),console.log("Websocket Open!")}},{key:"receiveSocketMessage",value:function(e){this.buf=new Uint8Array(e.data);var t=new Uint8Array(this.buf);"FMp4"===this.mediaType&&this.wfs.trigger(s.default.WEBSOCKET_ATTACHED,{payload:t}),"H264Raw"===this.mediaType&&this.wfs.trigger(s.default.H264_DATA_PARSING,{data:t})}},{key:"onWebsocketDataUploading",value:function(e){this.client.send(e.data)}},{key:"onWebsocketMessageSending",value:function(e){this.client.send(i()({t:e.commandType,c:e.channelName,v:e.commandValue}))}}]),t}(l.default);n.default=g},{"../event-handler":7,"../events":8,"../utils/h264-nal-slicesreader.js":14}],12:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(){r(this,e)}return a(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:a};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=i,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))}},{key:"box",value:function(e){var t,n=Array.prototype.slice.call(arguments,1),a=8,r=n.length,i=r;while(r--)a+=n[r].byteLength;for(t=new Uint8Array(a),t[0]=a>>24&255,t[1]=a>>16&255,t[2]=a>>8&255,t[3]=255&a,t.set(e,4),r=0,a=8;r<i;r++)t.set(n[r],a),a+=n[r].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,a){return e.box(e.types.moof,e.mfhd(t),e.traf(a,n))}},{key:"moov",value:function(t){var n=t.length,a=[];while(n--)a[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(a).concat(e.mvex(t)))}},{key:"mvex",value:function(t){var n=t.length,a=[];while(n--)a[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(a))}},{key:"mvhd",value:function(t,n){n*=t;var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var n,a,r=t.samples||[],i=new Uint8Array(4+r.length);for(a=0;a<r.length;a++)n=r[a].flags,i[a+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,i)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,a,r,i=[],s=[];for(n=0;n<t.sps.length;n++)a=t.sps[n],r=a.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(a));for(n=0;n<t.pps.length;n++)a=t.pps[n],r=a.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(a));var o=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),l=t.width,u=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,106,101,102,102,45,121,97,110,47,47,47,103,119,102,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,a=t.duration*t.timescale,r=t.width,i=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))}},{key:"traf",value:function(t,n){var a=e.sdtp(t),r=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,a.length+16+16+8+16+8+8),a)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var a,r,i,s,o,l,u=t.samples||[],c=u.length,d=12+16*c,f=new Uint8Array(d);for(n+=8+d,f.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),a=0;a<c;a++)r=u[a],i=r.duration,s=r.size,o=r.flags,l=r.cts,f.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*a);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var n,a=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+a.byteLength),n.set(e.FTYP),n.set(a,e.FTYP.byteLength),n}}]),e}();n.default=i},{}],13:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../helper/aac"),i=h(r),s=e("../events"),o=h(s),l=e("../utils/logger"),u=e("../remux/mp4-generator"),c=h(u),f=e("../errors");function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e("../utils/polyfill");var v=function(){function e(t,n,a){p(this,e),this.observer=t,this.id=n,this.config=a,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this.nextAvcDts=90300,this.H264_TIMEBASE=3e3}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"pushVideo",value:function(e,t,n,a,r){this.level=e,this.sn=t;this.ISGenerated||this.generateVideoIS(n,a),this.ISGenerated&&n.samples.length&&this.remuxVideo_2(n,a,r)}},{key:"remuxVideo_2",value:function(e,t,n,a){var r,i,s=8,u=(this.PES_TIMESCALE,this.PES2MP4SCALEFACTOR,e.samples),d=[];r=new Uint8Array(e.len+4*e.nbNalu+8);var f=new DataView(r.buffer);f.setUint32(0,r.byteLength),r.set(c.default.types.mdat,4);for(var h=0,p=void 0,v=void 0,m=void 0,y=0;y<u.length;y++){var g=u[y],b=0;while(g.units.units.length){var _=g.units.units.shift();f.setUint32(s,_.data.byteLength),s+=4,r.set(_.data,s),s+=_.data.byteLength,b+=4+_.data.byteLength}var E=g.pts-this._initPTS,w=g.dts-this._initDTS;if(w=Math.min(E,w),void 0!==m)p=this._PTSNormalize(E,m),v=this._PTSNormalize(w,m),h=v-m,h<=0&&(l.logger.log("invalid sample duration at PTS/DTS: "+g.pts+"/"+g.dts+"|dts norm: "+v+"|lastDTS: "+m+":"+h),h=1);else{var A,T=this.nextAvcDts;p=this._PTSNormalize(E,T),v=this._PTSNormalize(w,T),T&&(A=Math.round(v-T),Math.abs(A)<600&&A&&(A>1?l.logger.log("AVC:"+A+" ms hole between fragments detected,filling it"):A<-1&&l.logger.log("AVC:"+-A+" ms overlapping between fragments detected"),v=T,p=Math.max(p-A,v),l.logger.log("Video/PTS/DTS adjusted: "+p+"/"+v+",delta:"+A))),this.firstPTS=Math.max(0,p),this.firstDTS=Math.max(0,v),h=.03}d.push({size:b,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:g.key?2:1,isNonSync:g.key?0:1}}),m=v}var k=0;d.length>=2&&(k=d[d.length-2].duration,d[0].duration=k),this.nextAvcDts=v+k;var S=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,d.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var x=d[0].flags;x.dependsOn=2,x.isNonSync=0}e.samples=d,i=c.default.moof(e.sequenceNumber++,v,e),e.samples=[];var R={id:this.id,level:this.level,sn:this.sn,data1:i,data2:r,startPTS:p,endPTS:p,startDTS:v,endDTS:v,type:"video",nb:d.length,dropped:S};return this.observer.trigger(o.default.FRAG_PARSING_DATA,R),R}},{key:"generateVideoIS",value:function(e,t){var n,a,r=this.observer,i=e.samples,s=(this.PES_TIMESCALE,{}),l={id:this.id,level:this.level,sn:this.sn,tracks:s,unique:!1},u=void 0===this._initPTS;u&&(n=a=1/0),e.sps&&e.pps&&i.length&&(e.timescale=9e4,s.video={container:"video/mp4",codec:e.codec,initSegment:c.default.initSegment([e]),metadata:{width:e.width,height:e.height}},u&&(n=Math.min(n,i[0].pts-this.H264_TIMEBASE),a=Math.min(a,i[0].dts-this.H264_TIMEBASE))),d()(s).length?(r.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,l),this.ISGenerated=!0,u&&(this._initPTS=n,this._initDTS=a)):console.log("generateVideoIS ERROR==> ",f.ErrorTypes.MEDIA_ERROR)}},{key:"remux",value:function(e,t,n,a,r,i,s,l){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(n,a,s),this.ISGenerated)if(n.samples.length){var u=this.remuxAudio(n,s,l);if(a.samples.length){var c=void 0;u&&(c=u.endPTS-u.startPTS),this.remuxVideo(a,s,l,c)}}else{var d=void 0;a.samples.length&&(d=this.remuxVideo(a,s,l)),d&&n.codec&&this.remuxEmptyAudio(n,s,l,d)}r.samples.length&&this.remuxID3(r,s),i.samples.length&&this.remuxText(i,s),this.observer.trigger(o.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n){var a,r,i=this.observer,s=e.samples,u=t.samples,h=this.PES_TIMESCALE,p={},v={id:this.id,level:this.level,sn:this.sn,tracks:p,unique:!1},m=void 0===this._initPTS;if(m&&(a=r=1/0),e.config&&s.length){if(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)){var y=function e(t,n){return n?e(n,t%n):t};e.timescale=e.audiosamplerate/y(e.audiosamplerate,1024)}l.logger.log("audio mp4 timescale :"+e.timescale),p.audio={container:"audio/mp4",codec:e.codec,initSegment:c.default.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(a=r=s[0].pts-h*n)}t.sps&&t.pps&&u.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:c.default.initSegment([t]),metadata:{width:t.width,height:t.height}},m&&(a=Math.min(a,u[0].pts-h*n),r=Math.min(r,u[0].dts-h*n))),d()(p).length?(i.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,m&&(this._initPTS=a,this._initDTS=r)):i.trigger(o.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,id:this.id,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,a){var r,i,s,u,d,f,h,p=8,v=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,y=e.samples,g=[],b=void 0;b=n?this.nextAvcDts:t*v;var _=y[0];d=Math.max(this._PTSNormalize(_.dts,b)-this._initDTS,0),u=Math.max(this._PTSNormalize(_.pts,b)-this._initDTS,0);var E=Math.round((d-b)/90);n&&E&&(E>1?l.logger.log("AVC:"+E+" ms hole between fragments detected,filling it"):E<-1&&l.logger.log("AVC:"+-E+" ms overlapping between fragments detected"),d=b,y[0].dts=d+this._initDTS,u=Math.max(u-E,b),y[0].pts=u+this._initDTS,l.logger.log("Video/PTS/DTS adjusted: "+u+"/"+d+",delta:"+E)),_=y[y.length-1],h=Math.max(this._PTSNormalize(_.dts,b)-this._initDTS,0),f=Math.max(this._PTSNormalize(_.pts,b)-this._initDTS,0),f=Math.max(f,h);var w=navigator.vendor,A=navigator.userAgent,T=w&&w.indexOf("Apple")>-1&&A&&!A.match("CriOS");T&&(r=Math.round((h-d)/(m*(y.length-1))));for(var k=0;k<y.length;k++){var S=y[k];T?S.dts=d+k*m*r:(S.dts=Math.max(this._PTSNormalize(S.dts,b)-this._initDTS,d),S.dts=Math.round(S.dts/m)*m),S.pts=Math.max(this._PTSNormalize(S.pts,b)-this._initDTS,S.dts),S.pts=Math.round(S.pts/m)*m}i=new Uint8Array(e.len+4*e.nbNalu+8);var x=new DataView(i.buffer);x.setUint32(0,i.byteLength),i.set(c.default.types.mdat,4);for(var R=0;R<y.length;R++){var C=y[R],D=0,L=void 0;while(C.units.units.length){var M=C.units.units.shift();x.setUint32(p,M.data.byteLength),p+=4,i.set(M.data,p),p+=M.data.byteLength,D+=4+M.data.byteLength}if(T)L=Math.max(0,r*Math.round((C.pts-C.dts)/(m*r)));else{if(R<y.length-1)r=y[R+1].dts-C.dts;else{var I=this.config,O=C.dts-y[R>0?R-1:R].dts;if(I.stretchShortVideoTrack){var P=I.maxBufferHole,N=I.maxSeekHole,U=Math.floor(Math.min(P,N)*v),B=(a?u+a*v:this.nextAacPts)-C.pts;B>U?(r=B-O,r<0&&(r=O),l.logger.log("It is approximately "+B/90+" ms to the next segment; using duration "+r/90+" ms for the last video frame.")):r=O}else r=O}r/=m,L=Math.round((C.pts-C.dts)/m)}g.push({size:D,duration:r,cts:L,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:C.key?2:1,isNonSync:C.key?0:1}})}this.nextAvcDts=h+r*m;var F=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var G=g[0].flags;G.dependsOn=2,G.isNonSync=0}e.samples=g,s=c.default.moof(e.sequenceNumber++,d/m,e),e.samples=[];var H={id:this.id,level:this.level,sn:this.sn,data1:s,data2:i,startPTS:u/v,endPTS:(f+m*r)/v,startDTS:u/v,endDTS:(f+m*r)/v,type:"video",nb:g.length,dropped:F};return this.observer.trigger(o.default.FRAG_PARSING_DATA,H),H}},{key:"remuxAudio",value:function(e,t,n){var a,r,s,u,d,f,h,p,v,m,y,g,b,_=this.PES_TIMESCALE,E=e.timescale,w=_/E,A=1024*e.timescale/e.audiosamplerate,T=8,k=[],S=[];e.samples.sort(function(e,t){return e.pts-t.pts}),S=e.samples;for(var x=n?this.nextAacPts:t*_,R=this._PTSNormalize(S[0].pts-this._initPTS,x),C=A*w,D=R+C,L=1;L<S.length;){var M=S[L],I=this._PTSNormalize(M.pts-this._initPTS,x),O=I-D;if(O<-.5*C)l.logger.log("Dropping frame due to "+Math.abs(O/90)+" ms overlap."),S.splice(L,1),e.len-=M.unit.length;else if(O>.5*C){var P=Math.round(O/C);l.logger.log("Injecting "+P+" frame"+(P>1?"s":"")+" of missing audio due to "+Math.round(O/90)+" ms gap.");for(var N=0;N<P;N++){var U=S[L-1].pts+C,B=i.default.getSilentFrame(e.channelCount);B||(l.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),B=M.unit.slice(0)),S.splice(L,0,{unit:B,pts:U,dts:U}),e.len+=B.length,L+=1}D+=(P+1)*C,M.pts=S[L-1].pts+C,L+=1}else Math.abs(O)>.1*C&&l.logger.log("Invalid frame delta "+(I-D+C)+" at PTS "+Math.round(I/90)+" (should be "+C+")."),D+=C,M.pts=S[L-1].pts+C,L+=1}while(S.length){if(r=S.shift(),u=r.unit,m=r.pts-this._initDTS,y=r.dts-this._initDTS,void 0!==v)g=this._PTSNormalize(m,v),b=this._PTSNormalize(y,v),s.duration=(b-v)/w;else{g=this._PTSNormalize(m,x),b=this._PTSNormalize(y,x);var F=Math.round(1e3*(g-x)/_);if(n&&F){if(F>0)l.logger.log(F+" ms hole between AAC samples detected,filling it");else if(F<-12){l.logger.log(-F+" ms overlapping between AAC samples detected, drop frame"),e.len-=u.byteLength;continue}g=b=x}if(h=Math.max(0,g),p=Math.max(0,b),!(e.len>0))return;d=new Uint8Array(e.len+8),a=new DataView(d.buffer),a.setUint32(0,d.byteLength),d.set(c.default.types.mdat,4)}d.set(u,T),T+=u.byteLength,s={size:u.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},k.push(s),v=b}var G=0,H=k.length;if(H>=2&&(G=k[H-2].duration,s.duration=G),H){this.nextAacPts=g+w*G,e.len=0,e.samples=k,f=c.default.moof(e.sequenceNumber++,p/w,e),e.samples=[];var j={id:this.id,level:this.level,sn:this.sn,data1:f,data2:d,startPTS:h/_,endPTS:this.nextAacPts/_,startDTS:p/_,endDTS:(b+w*G)/_,type:"audio",nb:H};return this.observer.trigger(o.default.FRAG_PARSING_DATA,j),j}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,a){var r=this.PES_TIMESCALE,s=e.timescale?e.timescale:e.audiosamplerate,o=r/s,u=a.startDTS*r+this._initDTS,c=a.endDTS*r+this._initDTS,d=1024,f=o*d,h=Math.ceil((c-u)/f),p=i.default.getSilentFrame(e.channelCount);if(p){for(var v=[],m=0;m<h;m++){var y=u+m*f;v.push({unit:p.slice(0),pts:y,dts:y}),e.len+=p.length}e.samples=v,this.remuxAudio(e,t,n)}else l.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},{key:"remuxID3",value:function(e,t){var n,a=e.samples.length;if(a){for(var r=0;r<a;r++)n=e.samples[r],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(o.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,a=e.samples.length;if(a){for(var r=0;r<a;r++)n=e.samples[r],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(o.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;n=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=v},{"../errors":6,"../events":8,"../helper/aac":9,"../remux/mp4-generator":12,"../utils/logger":15,"../utils/polyfill":16}],14:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("../events"),i=c(r),s=e("../event-handler"),o=c(s),l=e("../demux/h264-demuxer"),u=c(l);function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==Object(_["a"])(t)&&"function"!==typeof t?e:t}function p(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+Object(_["a"])(t));e.prototype=y()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(v.a?v()(e,t):e.__proto__=t)}var m=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;d(this,t);var a=f(this,(t.__proto__||h()(t)).call(this,e,i.default.H264_DATA_PARSING));return a.config=a.wfs.config||n,a.h264Demuxer=new u.default(e),a.wfs=e,a.lastBuf=null,a.nals=[],a}return p(t,e),a(t,[{key:"destroy",value:function(){this.lastBuf=null,this.nals=[],o.default.prototype.destroy.call(this)}},{key:"_read",value:function(e){var t=null;if(this.nals=[],e&&!(e.byteLength<1)){this.lastBuf?(t=new Uint8Array(e.byteLength+this.lastBuf.length),t.set(this.lastBuf),t.set(new Uint8Array(e),this.lastBuf.length)):t=new Uint8Array(e);for(var n=0,a=-1,r=-2,i=new Array,s=0;s<t.length;s+=2){var o=t[s],l=t[s+1];0==a&&0==o&&0==l?i.push(s-1):1==l&&0==o&&0==a&&0==r&&i.push(s-2),r=o,a=l}if(i.length>1)for(s=0;s<i.length-1;++s)this.nals.push(t.subarray(i[s],i[s+1]+1)),n=i[s+1];else n=i[0];if(0!=n&&n<t.length)this.lastBuf=t.subarray(n);else{this.lastBuf||(this.lastBuf=t);var u=new Uint8Array(this.lastBuf.length+e.byteLength);u.set(this.lastBuf),u.set(new Uint8Array(e),this.lastBuf.length),this.lastBuf=u}}}},{key:"onH264DataParsing",value:function(e){this._read(e.data);var t=this;this.nals.forEach(function(e){t.wfs.trigger(i.default.H264_DATA_PARSED,{data:e})})}}]),t}(o.default);n.default=m},{"../demux/h264-demuxer":5,"../event-handler":7,"../events":8}],15:[function(e,t,n){b()(n,"__esModule",{value:!0});var a="function"===typeof u.a&&"symbol"===Object(_["a"])(o.a)?function(e){return Object(_["a"])(e)}:function(e){return e&&"function"===typeof u.a&&e.constructor===u.a&&e!==u.a.prototype?"symbol":Object(_["a"])(e)};function r(){}var i={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=i;function l(e,t){return t="["+e+"] > "+t,t}function c(e){var t=window.console[e];return t?function(){for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];a[0]&&(a[0]=l(e,a[0])),t.apply(window.console,a)}:r}function d(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];n.forEach(function(t){s[t]=e[t]?e[t].bind(e):c(t)})}n.enableLogs=function(e){if(!0===e||"object"===("undefined"===typeof e?"undefined":a(e))){d(e,"debug","log","info","warn","error");try{s.log()}catch(t){s=i}}else s=i},n.logger=s},{}],16:[function(e,t,n){"undefined"===typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n=new Uint8Array(this);void 0===t&&(t=n.length);for(var a=new ArrayBuffer(t-e),r=new Uint8Array(a),i=0;i<r.length;i++)r[i]=n[i+e];return a})},{}],17:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(t){r(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return a(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"loadHead",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay;var a=new XMLHttpRequest;a.open("head",e.url),a.onload=function(){n.onSuccess(a.getResponseHeader("content-length"))},a.send()}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!==typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"loadend",value:function(e){var t=e.currentTarget,n=t.status,a=this.stats,r=this.context,i=this.config;if(!a.aborted)if(window.clearTimeout(this.requestTimeout),n>=200&&n<300){a.tload=Math.max(a.tfirst,performance.now());var s=void 0,o=void 0;"arraybuffer"===r.responseType?(s=t.response,o=s.byteLength):(s=t.responseText,o=s.length),a.loaded=a.total=o;var l={url:t.responseURL,data:s};this.callbacks.onSuccess(l,a,r)}else a.retry>=i.maxRetry||n>=400&&n<499?this.callbacks.onError({code:n,text:t.statusText},r):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,i.maxRetryDelay),a.retry++)}},{key:"loadtimeout",value:function(){this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=i},{}],18:[function(e,t,n){b()(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),b()(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("./events"),i=m(r),s=e("./controller/flow-controller"),o=m(s),l=e("./controller/buffer-controller"),u=m(l),c=e("events"),d=m(c),f=e("./utils/xhr-loader"),h=m(f),p=e("./loader/websocket-loader"),v=m(p);function m(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,e);var n=e.DefaultConfig;for(var a in n)a in t||(t[a]=n[a]);this.config=t;var r=this.observer=new d.default;r.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];r.emit.apply(r,[e,e].concat(n))},r.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];r.removeListener.apply(r,[e].concat(n))},this.on=r.on.bind(r),this.off=r.off.bind(r),this.trigger=r.trigger.bind(r),this.flowController=new o.default(this),this.bufferController=new u.default(this),this.websocketLoader=new v.default(this),this.mediaType=void 0}return a(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"===typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42c01f,mp4a.40.2"')}},{key:"version",get:function(){return"v.0.0.0.1"}},{key:"Events",get:function(){return i.default}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,debug:!1,fLoader:void 0,loader:h.default,fmp4FileUrl:"xxxx.mp4",fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,forceKeyFrameOnDiscontinuity:!0,appendErrorMaxRetry:3}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),a(e,[{key:"destroy",value:function(){this.flowController.destroy(),this.bufferController.destroy(),this.websocketLoader.destroy()}},{key:"attachMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"chX",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"H264Raw",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"192.168.2.192:9002";this.mediaType=n,this.media=e,this.trigger(i.default.MEDIA_ATTACHING,{media:e,channelName:t,mediaType:n,websocketName:a})}},{key:"attachWebsocket",value:function(e,t){this.trigger(i.default.WEBSOCKET_ATTACHING,{websocket:e,mediaType:this.mediaType,channelName:t})}}]),e}();n.default=g},{"./controller/buffer-controller":2,"./controller/flow-controller":3,"./events":8,"./loader/websocket-loader":11,"./utils/xhr-loader":17,events:1}]},{},[10])(10)})}).call(this,n("dd40")(e),n("c8ba"))},"100d":function(e,t,n){"use strict";var a=n("9192"),r=n.n(a);r.a},"1f4a":function(e,t,n){e.exports=n.p+"img/icon_failed.3b0c2743.png"},"21bb":function(e,t,n){"use strict";var a=n("bcc9"),r=n.n(a);r.a},"21da":function(e,t,n){"use strict";var a=n("6fa3"),r=n.n(a);r.a},"2e78":function(e,t,n){"use strict";var a=n("71d5"),r=n.n(a);r.a},4028:function(e,t,n){e.exports=n.p+"img/mavartar_default.7b9f8309.png"},"42bc":function(e,t,n){e.exports=n.p+"img/card_machine.a7997cb8.png"},"4f7c":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"},[n("router-view")],1)},i=[],s=n("2877"),o={},l=Object(s["a"])(o,r,i,!1,null,null,null),u=l.exports,c=n("8c4f"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("div",{staticClass:"stream-content"},[n("video",{ref:"video",attrs:{width:"100%",height:"100%",controls:"",mute:"",autoplay:""}})]),n("div",{staticClass:"side-content"},[n("div",{staticClass:"top-side"},[n("Avartar",{attrs:{avartar:e.bgImage,smallAvartar:e.bgImage,working:!1}})],1),n("div",{staticClass:"bottom-side"},e._l(3,function(t){return n("div",{key:t,staticClass:"records-cell"},[n("IdentityRecord",{attrs:{avartar:e.bgImage,recordName:"弹力小笼包",recordTime:"8:56:56"}})],1)}),0)])])},f=[],h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"avartar"},[n("div",{staticClass:"aperture",class:{"working circle-animation":e.working}}),n("div",{staticClass:"avartar-img",style:{backgroundImage:e.avartarBgImage}}),n("div",{staticClass:"s-avartar"},[n("div",{staticClass:"s-avartar-img",style:{backgroundImage:e.smallAvartarBgImage}})])])},p=[],v=n("ac9a"),m=n.n(v),y=n("4028"),g=n.n(y),b={props:["avartar","smallAvartar","working"],data:function(){return{defaultAvartar:"url(".concat(m.a,")"),s_defaultAvartar:"url(".concat(g.a,")")}},computed:{avartarBgImage:function(){var e=this.avartar?this.avartar:m.a;return"url(".concat(e,")")},smallAvartarBgImage:function(){var e=this.smallAvartar?this.smallAvartar:g.a;return"url(".concat(e,")")}}},_=b,E=(n("e1b8"),Object(s["a"])(_,h,p,!1,null,null,null)),w=E.exports,A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"identity-record"},[n("div",{staticClass:"avartar-identity",style:{backgroundImage:e.smallAvartar}}),n("div",{staticClass:"record-name nowrap"},[e._v(e._s(e.recordName))]),n("div",{staticClass:"record-time"},[e._v(e._s(e.recordTime))])])},T=[],k={props:["avartar","recordName","recordTime"],data:function(){return{}},computed:{smallAvartar:function(){var e=this.avartar?this.avartar:g.a;return"url(".concat(e,")")}}},S=k,x=(n("ec60"),Object(s["a"])(S,A,T,!1,null,null,null)),R=x.exports,C=(n("0c92"),{name:"home",data:function(){return{bgImage:""}},mounted:function(){var e=this.$refs.video,t=new Wfs;t.attachMedia(e),console.log(t.websocketLoader.client),console.log(t)},components:{Avartar:w,IdentityRecord:R}}),D=C,L=(n("21bb"),Object(s["a"])(D,d,f,!1,null,null,null)),M=L.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"second-verify"},[n("BackNav",{attrs:{text:"二次验证"}}),n("div",{staticClass:"verify-input"},[n("div",[e._m(0),n("PasswordInput",{attrs:{value:e.keyNumber}}),e._m(1)],1)]),n("div",{staticClass:"verify-keypad"},[n("Numerickeypad",{model:{value:e.keyNumber,callback:function(t){e.keyNumber=t},expression:"keyNumber"}})],1)],1)},O=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pass-avartar-wrap"},[n("div",{staticClass:"pass-avartar working circle-animation"}),n("div",{staticClass:"pass-avartar-image"},[n("img",{attrs:{src:"https://interactive-examples.mdn.mozilla.net/media/examples/plumeria.jpg"}})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pass-error"},[n("i",{staticClass:"iconfont icon-error"}),e._v("\n        请重新输入（剩余2次机会）\n      ")])}],P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"numeric-keypad"},[n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(1)}}},[e._v("1")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(2)}}},[e._v("2")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(3)}}},[e._v("3")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(4)}}},[e._v("4")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(5)}}},[e._v("5")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(6)}}},[e._v("6")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(7)}}},[e._v("7")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(8)}}},[e._v("8")])]),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(9)}}},[e._v("9")])]),n("div",{staticClass:"number-cell"}),n("div",{staticClass:"number-cell"},[n("button",{on:{touchstart:e.test,click:function(t){return e.keyIn(0)}}},[e._v("0")])]),n("div",{staticClass:"number-cell"},[n("button",{staticClass:"number-delete",on:{touchstart:e.test,click:e.deletKey}},[n("i",{staticClass:"iconfont icon-delete"})])])])},N=[],U=(n("6b54"),n("c5f6"),{props:{value:{type:String,default:""},max:{type:Number,default:4}},model:{prop:"value",event:"change"},data:function(){return{}},methods:{test:function(){console.log("xxxx")},keyIn:function(e){this.value.length<4&&this.$emit("change",this.value+e.toString())},deletKey:function(){this.$emit("change",this.value.slice(0,-1))}}}),B=U,F=(n("100d"),Object(s["a"])(B,P,N,!1,null,null,null)),G=F.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"password-input"},[n("div",{staticClass:"input-cell",class:{"on-input":0===e.value.length}},[e._v(e._s(e.value[0]))]),n("div",{staticClass:"input-cell",class:{"on-input":1===e.value.length}},[e._v(e._s(e.value[1]))]),n("div",{staticClass:"input-cell",class:{"on-input":2===e.value.length}},[e._v(e._s(e.value[2]))]),n("div",{staticClass:"input-cell",class:{"on-input":3===e.value.length}},[e._v(e._s(e.value[3]))])])},j=[],V={props:["value"],data:function(){return{}},computed:{}},W=V,z=(n("2e78"),Object(s["a"])(W,H,j,!1,null,null,null)),$=z.exports,K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-title",on:{click:e.goHome}},[n("i",{staticClass:"iconfont icon-arrow-left"}),e._v("\n  "+e._s(e.text)+"\n")])},q=[],Y={props:["text"],methods:{goHome:function(){this.$router.push("/")}}},Z=Y,X=(n("85b6"),Object(s["a"])(Z,K,q,!1,null,null,null)),J=X.exports,Q={components:{Numerickeypad:G,PasswordInput:$,BackNav:J},data:function(){return{keyNumber:""}}},ee=Q,te=(n("e24f"),Object(s["a"])(ee,I,O,!1,null,null,null)),ne=te.exports,ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sign-up"},[n("BackNav",{attrs:{text:"注册 Face ID"}}),n("div",{staticClass:"steps"},[n("el-steps",{attrs:{active:e.activeStep,"align-center":""}},[n("el-step",{attrs:{title:"录入照片"}}),n("el-step",{attrs:{title:"填写资料"}}),n("el-step",{attrs:{title:"admin认证"}})],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:1===e.activeStep,expression:"activeStep === 1"}],staticClass:"entry-data"},[n("div",{staticClass:"progress-wrap"},[n("el-progress",{attrs:{type:"circle",percentage:e.progress,color:"#6FC9EF","show-text":!1,width:640,"stroke-width":28}},[n("div",{staticClass:"ssss"})]),n("div",{staticClass:"input-data"})],1),n("div",{staticClass:"entry-data-status"},[e._v("信息展示")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:2===e.activeStep,expression:"activeStep === 2"}],staticClass:"fill-info"},[e._m(0),e._m(1),n("div",{staticClass:"info-form-wrap"},[n("InfoForm")],1)]),n("div",{directives:[{name:"show",rawName:"v-show",value:3===e.activeStep,expression:"activeStep === 3"}],staticClass:"signup-result"},[n("Prompt",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"success",text:"通过认证，注册成功"}}),n("Prompt",{attrs:{type:"failed",text:"管理员认证失败"}},[n("div",{staticClass:"admin-refused"},[n("el-button",[e._v("取消注册")]),n("el-button",{attrs:{type:"primary"}},[e._v("重新认证")])],1)])],1)],1)},re=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card-img"},[a("img",{attrs:{src:n("42bc"),width:"173"}}),a("div",{staticClass:"card-tips"},[e._v("刷卡机上刷卡")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"info-split"},[n("span",[e._v("或")])])}],ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{staticClass:"info-form",attrs:{model:e.form,"label-width":"150px","label-position":"left"}},[n("el-form-item",{attrs:{label:"姓名"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"手机号"}},[n("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),n("el-button",{attrs:{type:"primary"}},[e._v("提交")])],1)},se=[],oe={data:function(){return{form:{name:"",phone:""}}}},le=oe,ue=(n("e808"),Object(s["a"])(le,ie,se,!1,null,null,null)),ce=ue.exports,de=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"prompt"},[a("div",{staticClass:"prompt-icon"},["success"===e.type?a("img",{attrs:{src:n("81a6")}}):"failed"===e.type?a("img",{attrs:{src:n("1f4a")}}):e._e()]),a("div",{staticClass:"prompt-text"},[e._v(e._s(e.text))]),e._t("default",[a("div",{staticClass:"prompt-jump"},[e._v("2s后自动跳转")])])],2)},fe=[],he={props:{type:{type:String,default:"success"},text:{type:String}},data:function(){return{}}},pe=he,ve=(n("97ce"),Object(s["a"])(pe,de,fe,!1,null,null,null)),me=ve.exports,ye={components:{BackNav:J,InfoForm:ce,Prompt:me},data:function(){return{progress:15,activeStep:3}}},ge=ye,be=(n("21da"),Object(s["a"])(ge,ae,re,!1,null,null,null)),_e=be.exports;a["default"].use(c["a"]);var Ee=new c["a"]({routes:[{path:"/",name:"home",component:M},{path:"/prompt",component:me},{path:"/form",component:ce},{path:"/signup",name:"signup",component:_e},{path:"/second",name:"second",component:ne},{path:"/about",name:"about",component:function(){return n.e("about").then(n.bind(null,"f820"))}}]}),we=n("2f62");a["default"].use(we["a"]);var Ae=new we["a"].Store({state:{},mutations:{},actions:{}}),Te=n("bc3a"),ke=n.n(Te),Se=(n("f5df"),n("a41b"),n("0fb7"),n("450d"),n("f529")),xe=n.n(Se),Re=(n("eca7"),n("3787")),Ce=n.n(Re),De=(n("425f"),n("4105")),Le=n.n(De),Me=(n("6b30"),n("c284")),Ie=n.n(Me),Oe=(n("9c49"),n("6640")),Pe=n.n(Oe),Ne=(n("d2ac"),n("95b0")),Ue=n.n(Ne),Be=(n("10cb"),n("f3ad")),Fe=n.n(Be),Ge=(n("1951"),n("eedf")),He=n.n(Ge),je=(n("f4f9"),n("c2cc")),Ve=n.n(je),We=(n("7a0f"),n("0f6c")),ze=n.n(We),$e=(n("be4f"),n("896a")),Ke=n.n($e),qe=(n("a7cc"),n("df33")),Ye=n.n(qe);a["default"].use(Ye.a),a["default"].use(Ke.a.directive),a["default"].use(ze.a),a["default"].use(Ve.a),a["default"].use(He.a),a["default"].use(Fe.a),a["default"].use(Ue.a),a["default"].use(Pe.a),a["default"].use(Ie.a),a["default"].use(Le.a),a["default"].use(Ce.a),a["default"].prototype.$message=xe.a,ke.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",a["default"].prototype.axios=ke.a,a["default"].config.productionTip=!1,new a["default"]({router:Ee,store:Ae,render:function(e){return e(u)}}).$mount("#app")},"6fa3":function(e,t,n){},"71d5":function(e,t,n){},"81a6":function(e,t,n){e.exports=n.p+"img/icon_success.07ccba66.png"},"85b6":function(e,t,n){"use strict";var a=n("e234"),r=n.n(a);r.a},9192:function(e,t,n){},"97ce":function(e,t,n){"use strict";var a=n("0694"),r=n.n(a);r.a},"9d24":function(e,t,n){},a41b:function(e,t,n){},ac9a:function(e,t,n){e.exports=n.p+"img/avartar_default.77d6bb8f.png"},b321:function(e,t,n){},bcc9:function(e,t,n){},e1b8:function(e,t,n){"use strict";var a=n("f0c2"),r=n.n(a);r.a},e234:function(e,t,n){},e24f:function(e,t,n){"use strict";var a=n("b321"),r=n.n(a);r.a},e808:function(e,t,n){"use strict";var a=n("9d24"),r=n.n(a);r.a},ec60:function(e,t,n){"use strict";var a=n("4f7c"),r=n.n(a);r.a},f0c2:function(e,t,n){}});